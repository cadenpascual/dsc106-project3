<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dexcom Glucose Time Series</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .line { fill: none; stroke: steelblue; stroke-width: 2; }
        .axis-label { font-size: 12px; }
    </style>
</head>
<body>
    <h2>Dexcom Glucose Time Series (15-Minute Intervals)</h2>
    <svg width="800" height="500"></svg>
    <script>
        d3.csv("dexcom_processed.csv").then(function(data) {
            data.forEach(d => {
                d.Timestamp = new Date(d.Timestamp);
                d["Glucose Value (mg/dL)"] = +d["Glucose Value (mg/dL)"];
            });

            const width = 800, height = 500, margin = { top: 20, right: 30, bottom: 50, left: 50 };
            const svg = d3.select("svg").attr("width", width).attr("height", height);

            const x = d3.scaleTime()
                .domain(d3.extent(data, d => d.Timestamp))
                .range([margin.left, width - margin.right]);

            const y = d3.scaleLinear()
                .domain([d3.min(data, d => d["Glucose Value (mg/dL)"]), d3.max(data, d => d["Glucose Value (mg/dL)"])])
                .range([height - margin.bottom, margin.top]);

            const xAxis = d3.axisBottom(x).ticks(10);
            const yAxis = d3.axisLeft(y).ticks(10);

            svg.append("g")
                .attr("transform", `translate(0,${height - margin.bottom})`)
                .call(xAxis)
                .append("text")
                .attr("x", width / 2)
                .attr("y", 40)
                .attr("fill", "black")
                .attr("class", "axis-label")
                .style("text-anchor", "middle")
                .text("Time");

            svg.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -40)
                .attr("fill", "black")
                .attr("class", "axis-label")
                .style("text-anchor", "middle")
                .text("Glucose Level (mg/dL)");

            const line = d3.line()
                .x(d => x(d.Timestamp))
                .y(d => y(d["Glucose Value (mg/dL)"]));

            svg.append("path")
                .datum(data)
                .attr("class", "line")
                .attr("d", line);
        });
    </script>
</body>
</html>
